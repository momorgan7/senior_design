<p id="notice"><%= notice %></p>

<h1>Project List</h1>

<% if current_user && current_user.has_role?(:teacher) || current_user.has_role?(:admin)%>
<%= link_to 'New Project', new_project_path %><br> <br>
<%end%>

<table>
  <thead>
    <tr>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @projects.order(:name).each do |project| %>
        <% if project.visible %>
        <b><u><%= link_to  project.name, project %></u></b> <br>
        
        <p><%= project.desc %></p>
        
        <% project.organizations.uniq.each do |org| %>
        
          <% user_array = [] %>
          <% project.users.each do |user| %>
            <% if user.has_role?(:admin) || user.has_role?(:teacher) %>
              <% if user.organization_id == org.id %>
                <% user_array << user %>
              <% end %>
            <% end %>
          <% end %>
          
          <b><%= link_to org.name, org %></b>: 
          <% user_array.each do |user| %>
              <% if user == user_array.last %>
                <%= link_to user.username, user %>
              <% else %>
                <%= link_to user.username, user %>, 
              <% end %>
          <% end %>
          <br>
        <% end %>
       <br>
       <% end %>
    <% end %>
  </tbody>
</table>

<br>

